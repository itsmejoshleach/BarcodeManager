<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Item Search</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="icon" type="image/png" href="/static/icon.png">

    <style>
        body { height: 100vh; overflow: hidden; }
        .sidebar { width: 260px; background-color: #0f1115; }
        .sidebar .nav-link { color: #adb5bd; }
        .sidebar .nav-link:hover, .sidebar .nav-link.active { color: #fff; background-color: rgba(255,255,255,0.08); border-radius: 6px; }
        main { background-image: url("/static/background.jpg"); background-size: cover; background-position: center bottom; }
        .glass-card { background: rgba(15,17,21,0.75); backdrop-filter: blur(8px); border-radius: 12px; box-shadow: rgba(0,0,0,0.6) 0 20px 50px; }
        .item-card { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 16px; margin-bottom: 16px; }
        img.label { max-width: 250px; border-radius: 6px; border: 1px solid #444; }
        footer { font-size: 0.85rem; color: #9aa0a6; }
    </style>
</head>

<body>
<div class="d-flex h-100">

    <!-- SIDEBAR -->
    <aside class="sidebar p-3 d-flex flex-column">
        <div class="mb-4">
            <h4 class="text-white mb-0"><i class="fa-solid fa-boxes-stacked me-2"></i>Inventory</h4>
        </div>

        <nav class="nav nav-pills flex-column gap-1">
            <a class="nav-link {% if page=='items' %}active{% endif %}" href="{{ url_for('index') }}">
                <i class="fa-solid fa-magnifying-glass me-2"></i> Item Search
            </a>
            <a class="nav-link {% if page=='polling' %}active{% endif %}" href="{{ url_for('polling') }}">
                <i class="fa-solid fa-chart-line me-2"></i> Polling
            </a>
            <a class="nav-link {% if page=='custom' %}active{% endif %}" href="{{ url_for('custom_barcodes') }}">
                <i class="fa-solid fa-barcode me-2"></i> Custom Barcodes
            </a>
        </nav>

        <div class="mt-auto text-secondary small">
            Made for internal CT (Creative Technology Group) Intranet usage
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-fill overflow-auto">
        <div class="container py-5">

            <div class="glass-card p-4 text-white">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="mb-0">Item Search</h2>
                    <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addItemModal">
                        <i class="fa-solid fa-plus me-1"></i> Add Item
                    </button>
                </div>

                <!-- SEARCH FORM -->
                <form method="POST" action="/" class="row g-2 mb-4">
                    <div class="col">
                        <input class="form-control form-control-lg" type="text" name="search" placeholder="Name, description, or barcode" value="{{ query }}">
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-primary btn-lg">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </div>
                </form>

                <!-- ITEM LIST -->
                {% for item in items %}
                <div class="item-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h5>{{ item.name }}</h5>
                            <p class="mb-1"><strong>Description:</strong> {{ item.description }}</p>
                            <p class="mb-2"><strong>Barcode:</strong> {{ item.barcode }}</p>
                        </div>

                        {% if item.label %}
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-outline-primary"
                                    onclick="printLabel('{{ url_for('static', filename=item.label) }}')">
                                <i class="fa-solid fa-print me-1"></i> Print Label
                            </button>

                            <form method="POST" action="{{ url_for('delete_label') }}">
                                <input type="hidden" name="filepath" value="{{ item.label }}">
                                <input type="hidden" name="page_type" value="items">
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i class="fa-solid fa-trash me-1"></i> Delete Label
                                </button>
                            </form>
                        </div>
                        {% endif %}
                    </div>

                    {% if item.label %}
                        <img class="label mt-3" src="{{ url_for('static', filename=item.label) }}" alt="Label for {{ item.name }}">
                    {% endif %}
                </div>
                {% else %}
                <p class="text-secondary">No items found.</p>
                {% endfor %}
            </div>

            <!-- FOOTER -->
            <footer class="text-center mt-5">
                <hr class="border-secondary">
                <p class="mb-1">
                    Any questions, please get in touch:
                    (<a href="mailto:jleach@ctlondon.com">jleach@ctlondon.com</a> /
                    <a href="mailto:josh@itsmejoshleach.co.uk">josh@itsmejoshleach.co.uk</a>)
                </p>
                <p class="mb-1">Â© itsmejoshleach 2025 - 2026</p>
            </footer>

        </div>
    </main>
</div>

<!-- ADD ITEM MODAL -->
<div class="modal fade" id="addItemModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form method="POST" action="/add">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Item Name</label>
                        <input class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <input class="form-control" name="description">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Barcode</label>
                        <input class="form-control" name="barcode" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary">Add Item</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
function printLabel(imageUrl) {
    const win = window.open('', '_blank');
    win.document.write(`
        <html>
            <head>
                <title>Print Label</title>
                <style>
                    @page { size: 50mm 25mm; margin: 0; }
                    body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
                    img { width: 50mm; height: 25mm; object-fit: contain; }
                </style>
            </head>
            <body onload="window.print(); window.close();">
                <img src="${imageUrl}">
            </body>
        </html>
    `);
    win.document.close();
}
</script>
</body>
</html>
